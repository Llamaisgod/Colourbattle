
window.__runtimeLoaded = true;

const EXPECTED_RUNTIME_HASH = "be8374d247b1896ed176c4289d10e1ff1ba984ecab3786bc64cb1d4c162a0793";
const __runtimeSource_b64 = "d2luZG93Ll9fcnVudGltZUxvYWRlZCA9IHRydWU7Ci8vIHJ1bnRpbWUuanMKKGZ1bmN0aW9uKCkgewogIGNvbnN0IGFsbG93ZWREb21haW4gPSAibGxhbWFpc2dvZC5naXRodWIuaW8iOwogIGNvbnN0IGFsbG93ZWRQYXRoID0gIi9Db2xvdXJiYXR0bGUvIjsKCiAgY29uc3QgY3VycmVudERvbWFpbiA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZTsKICBjb25zdCBjdXJyZW50UGF0aCA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTsKCiAgLy8gSWYgdGhlIHNjcmlwdCBpcyBydW5uaW5nIG9uIGEgcGFnZSBvdXRzaWRlIHlvdXIgc2l0ZSwgcmVkaXJlY3QKICBpZiAoY3VycmVudERvbWFpbiAhPT0gYWxsb3dlZERvbWFpbiB8fCAhY3VycmVudFBhdGguc3RhcnRzV2l0aChhbGxvd2VkUGF0aCkpIHsKICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gImh0dHBzOi8vbGxhbWFpc2dvZC5naXRodWIuaW8vQ29sb3VyYmF0dGxlLyI7CiAgfQp9KSgpOwovLyBydW50aW1lLmpzCihmdW5jdGlvbigpIHsKICBjb25zdCBhbGxvd2VkRG9tYWluID0gImxsYW1haXNnb2QuZ2l0aHViLmlvIjsKICBjb25zdCBhbGxvd2VkUGF0aCA9ICIvQ29sb3VyYmF0dGxlLyI7CgogIGNvbnN0IGN1cnJlbnREb21haW4gPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWU7CiAgY29uc3QgY3VycmVudFBhdGggPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7CgogIC8vIElmIHRoZSBzY3JpcHQgaXMgcnVubmluZyBvbiBhIHBhZ2Ugb3V0c2lkZSB5b3VyIHNpdGUsIHJlZGlyZWN0CiAgaWYgKGN1cnJlbnREb21haW4gIT09IGFsbG93ZWREb21haW4gfHwgIWN1cnJlbnRQYXRoLnN0YXJ0c1dpdGgoYWxsb3dlZFBhdGgpKSB7CiAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICJodHRwczovL2xsYW1haXNnb2QuZ2l0aHViLmlvL0NvbG91cmJhdHRsZS8iOwogIH0KfSkoKTsKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCAoKSA9PiB7CiAgICBpZiAoIXdpbmRvdy5fX2dhbWVMb2FkZWQpIHsKICAgICAgICAKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKTsKICAgIH0KfSk7Cg==";

async function __verifyRuntimeIntegrity() {
    const decoded = atob(__runtimeSource_b64);
    const data = new TextEncoder().encode(decoded);
    const hashBuffer = await crypto.subtle.digest("SHA-256", data);
    const hex = Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2,"0")).join("");
    if (hex !== EXPECTED_RUNTIME_HASH) throw new Error();
}

__verifyRuntimeIntegrity();

window.addEventListener("load", () => {
    if (!window.__gameLoaded) throw new Error();
});
